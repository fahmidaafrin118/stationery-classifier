<!DOCTYPE html>
<html>
<head>
  <title>Stationery Classifier</title>
  <meta charset="UTF-8" />

<style>
/* ===== Background Gradient ===== */
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #ffb3e6, #ff9de2, #ff8ad6);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0;

    /* ⭐ SCROLL ENABLED */
    overflow-y: auto;
    overflow-x: hidden;
}

/* ===== Mouse Glow Trail ===== */
.cursor-glow {
    position: fixed;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    pointer-events: none;
    background: radial-gradient(circle, rgba(255,255,255,0.95), rgba(255,182,193,0));
    transform: translate(-50%, -50%);
    animation: glowTrail 0.7s ease-out forwards;
    mix-blend-mode: screen;
    z-index: 3;
}
@keyframes glowTrail {
    from { opacity: 0.9; transform: translate(-50%, -50%) scale(1); }
    to   { opacity: 0;   transform: translate(-50%, -50%) scale(2.2); }
}

/* ===== Floating Bubbles (Soft Pink) ===== */
.bubbles {
    position: fixed;
    inset: 0;
    overflow: hidden;
    z-index: 0;
    pointer-events: none;
}

.bubbles span {
    position: absolute;
    display: block;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #ffffff99, #f4c2ffcc);
    opacity: 0.7;
    animation: float 18s linear infinite;
    filter: blur(1px);
}

.bubbles span:nth-child(2) {
    width: 60px; height: 60px;
    background: radial-gradient(circle at 30% 30%, #ffffffaa, #ffd6ffcc);
    animation-duration: 22s;
}
.bubbles span:nth-child(3) {
    width: 100px; height: 100px;
    background: radial-gradient(circle at 30% 30%, #ffffffaa, #e0c3ffcc);
    animation-duration: 26s;
}
.bubbles span:nth-child(4) {
    width: 50px; height: 50px;
    background: radial-gradient(circle at 30% 30%, #ffffffaa, #fbe7ffcc);
    animation-duration: 20s;
}
.bubbles span:nth-child(5) {
    width: 90px; height: 90px;
    background: radial-gradient(circle at 30% 30%, #ffffffaa, #e3d0ffcc);
    animation-duration: 24s;
}

.bubbles span:nth-child(1) { left: 10%; bottom: -100px; }
.bubbles span:nth-child(2) { left: 70%; bottom: -120px; }
.bubbles span:nth-child(3) { left: 50%; bottom: -130px; }
.bubbles span:nth-child(4) { left: 20%; bottom: -110px; }
.bubbles span:nth-child(5) { left: 85%; bottom: -150px; }

@keyframes float {
    0%   { transform: translateY(0) scale(1); opacity: 0; }
    10%  { opacity: 0.9; }
    50%  { transform: translateY(-50vh) scale(1.05); }
    100% { transform: translateY(-110vh) scale(1.1); opacity: 0; }
}

/* ===== Glassmorphism Card ===== */
.container {
    position: relative;
    z-index: 1;
    width: 420px;
    padding: 30px 28px 35px;
    border-radius: 28px;
    background: rgba(255, 255, 255, 0.23);
    box-shadow: 0 18px 60px rgba(210, 130, 255, 0.55);
    backdrop-filter: blur(22px);
    -webkit-backdrop-filter: blur(22px);
    border: 1px solid rgba(240, 210, 255, 0.75);
    text-align: center;
}

/* Heading */
h2 {
    margin-top: 0;
    margin-bottom: 8px;
    font-size: 26px;
    font-weight: 700;
    color: white;
}

.items-list {
    font-size: 13px;
    color: #ffe8ff;
    margin-bottom: 12px;
}

/* file input wrapper */
.file-wrapper {
    display: inline-block;
    padding: 8px 12px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.9);
    margin-bottom: 18px;
}

input[type="file"] {
    border: none;
    background: transparent;
    font-size: 14px;
}

/* Preview */
#preview {
    display: block;
    margin: 12px auto 0;
    border-radius: 20px;
    max-width: 100%;
}

/* ===== Scanner Bar ===== */
.scanner {
    position: absolute;
    top: 0;
    left: 50%;
    width: 70%;
    height: 12px;
    transform: translate(-50%, -120%);
    background: linear-gradient(to bottom, #ffffffcc, #ffffff00);
    animation: scan 2s linear infinite;
    border-radius: 10px;
    display: none;
    box-shadow: 0 0 12px rgba(255,255,255,0.8);
}

@keyframes scan {
    0% { transform: translate(-50%, -120%); }
    100% { transform: translate(-50%, 120%); }
}

/* Predict Button */
button {
    margin-top: 24px;
    padding: 14px 20px;
    width: 100%;
    background: linear-gradient(135deg, #4dbbff, #2196f3);
    color: white;
    border: none;
    border-radius: 999px;
    font-size: 17px;
    font-weight: 600;
    cursor: pointer;
    transition: 0.18s ease;
}

button:hover {
    transform: translateY(-3px);
}

/* ===== Bar Chart ===== */
#barsWrapper {
    margin-top: 20px;
    text-align: left;
}

/* Top Detected Big Bar */
.top-bar-row { margin-bottom: 12px; }

.top-bar-label {
    font-size: 14px;
    color: #4b2a50;
    margin-bottom: 4px;
}

.top-bar-bg {
    width: 100%;
    height: 18px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 0 12px rgba(244, 143, 177, 0.7);
}

.top-bar-fill {
    height: 100%;
    width: 0%;
    border-radius: 999px;
    background: linear-gradient(90deg, #ff9aeb, #f48fb1);
    transition: width 0.7s ease;
}

/* Other small bars */
.bar-row {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
}

.bar-label {
    width: 70px;
    font-size: 13px;
    text-transform: capitalize;
}

.bar-bg {
    flex: 1;
    height: 8px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.7);
}

.bar-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #f9c5ff, #f48fb1);
    border-radius: 999px;
    transition: width 0.7s ease;
}

/* ===== Result Card ===== */
#resultCardWrapper {
    margin-top: 20px;
}

.result-card {
    margin-top: 10px;
    padding: 14px 16px 16px;
    border-radius: 20px;
    background: rgba(255,255,255,0.82);
    border: 1px solid rgba(240, 210, 255, 0.9);
    box-shadow: 0 12px 30px rgba(180, 120, 220, 0.45);
    text-align: left;
}

.result-card-header {
    font-size: 14px;
    font-weight: 600;
    color: #4b2a50;
    margin-bottom: 6px;
}

.result-card-body {
    display: flex;
    gap: 10px;
    align-items: center;
}

.result-card-body img {
    width: 64px;
    height: 64px;
    object-fit: cover;
    border-radius: 16px;
    box-shadow: 0 8px 18px rgba(150, 100, 200, 0.5);
}

.result-card-text {
    font-size: 13px;
    color: #3a2445;
}

.result-card-text div {
    margin-bottom: 3px;
}

/* Download button */
#downloadBtn {
    margin-top: 10px;
    padding: 8px 14px;
    width: auto;
    font-size: 13px;
    border-radius: 999px;
    background: linear-gradient(135deg, #ff9ad9, #ff80c9);
    box-shadow: 0 8px 18px rgba(255, 128, 201, 0.6);
}
</style>

</head>
<body>

<!-- Floating Bubbles -->
<div class="bubbles">
    <span></span><span></span><span></span><span></span><span></span>
</div>

<div class="container">
    <h2>Stationery Classifier</h2>
    <div class="items-list">
        Items: <strong>pen</strong> • <strong>book</strong> • <strong>glue</strong> • <strong>eraser</strong> • <strong>ruler</strong>
    </div>

    <div class="file-wrapper">
        <input type="file" accept="image/*" onchange="loadImage(event)">
    </div>

    <div style="position:relative;">
        <img id="preview" width="230">
        <div id="scannerBar" class="scanner"></div>
    </div>

    <button id="predictBtn" onclick="predictNow()">Prediction will appear here…</button>

    <div id="barsWrapper"></div>

    <div id="resultCardWrapper"></div>
    <button id="downloadBtn" style="display:none;" onclick="downloadCard()">
        Download Result Card
    </button>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
const MODEL_URL = "https://teachablemachine.withgoogle.com/models/Z_L7k7LiI/";

let model;
let imageElement = null;
let lastTopPrediction = null;

// Mouse glow trail
document.addEventListener("mousemove", (e) => {
    const dot = document.createElement("span");
    dot.className = "cursor-glow";
    dot.style.left = e.clientX + "px";
    dot.style.top = e.clientY + "px";
    document.body.appendChild(dot);
    setTimeout(() => dot.remove(), 700);
});

// Load model
async function init() {
    if (!model) {
        model = await tmImage.load(MODEL_URL + "model.json", MODEL_URL + "metadata.json");
    }
}

// Load preview image
async function loadImage(event) {
    await init();
    const img = document.getElementById("preview");

    img.onload = () => {
        imageElement = img;
    };

    img.src = URL.createObjectURL(event.target.files[0]);
}

// Render Bar Chart
function renderBars(predictions) {
    const wrapper = document.getElementById("barsWrapper");
    wrapper.innerHTML = "";

    const top = predictions[0];

    // Top big bar
    const topRow = document.createElement("div");
    topRow.className = "top-bar-row";

    const topLabel = document.createElement("div");
    topLabel.className = "top-bar-label";
    topLabel.textContent = `${top.className} (${(top.probability * 100).toFixed(2)}%)`;

    const topBg = document.createElement("div");
    topBg.className = "top-bar-bg";

    const topFill = document.createElement("div");
    topFill.className = "top-bar-fill";
    topFill.style.width = "0%";

    requestAnimationFrame(() => {
        topFill.style.width = `${(top.probability * 100).toFixed(1)}%`;
    });

    topBg.appendChild(topFill);
    topRow.appendChild(topLabel);
    topRow.appendChild(topBg);
    wrapper.appendChild(topRow);

    // Other small bars
    for (let i = 1; i < predictions.length; i++) {
        const p = predictions[i];

        const row = document.createElement("div");
        row.className = "bar-row";

        const label = document.createElement("div");
        label.className = "bar-label";
        label.textContent = p.className;

        const bg = document.createElement("div");
        bg.className = "bar-bg";

        const fill = document.createElement("div");
        fill.className = "bar-fill";

        requestAnimationFrame(() => {
            fill.style.width = `${(p.probability * 100).toFixed(1)}%`;
        });

        bg.appendChild(fill);
        row.appendChild(label);
        row.appendChild(bg);

        wrapper.appendChild(row);
    }
}

// Create Result Card
function createResultCard(top) {
    const wrapper = document.getElementById("resultCardWrapper");
    wrapper.innerHTML = "";

    const card = document.createElement("div");
    card.id = "resultCard";
    card.className = "result-card";

    const header = document.createElement("div");
    header.className = "result-card-header";
    header.textContent = "Prediction Result";

    const body = document.createElement("div");
    body.className = "result-card-body";

    const img = document.createElement("img");
    img.src = imageElement ? imageElement.src : "";
    img.alt = "Detected item";

    const textBox = document.createElement("div");
    textBox.className = "result-card-text";

    const detected = document.createElement("div");
    detected.textContent = `Detected: ${top.className}`;

    const acc = document.createElement("div");
    acc.textContent = `Accuracy: ${(top.probability * 100).toFixed(2)}%`;

    const time = document.createElement("div");
    const now = new Date();
    time.textContent = `Time: ${now.toLocaleString()}`;

    textBox.appendChild(detected);
    textBox.appendChild(acc);
    textBox.appendChild(time);

    body.appendChild(img);
    body.appendChild(textBox);

    card.appendChild(header);
    card.appendChild(body);

    wrapper.appendChild(card);

    // Show download button
    document.getElementById("downloadBtn").style.display = "inline-block";
}

// Download result card as PNG
function downloadCard() {
    const card = document.getElementById("resultCard");
    if (!card) return;

    html2canvas(card, {backgroundColor: null}).then(canvas => {
        const link = document.createElement("a");
        link.download = "stationery-result.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
    });
}

// Predict
async function predictNow() {
    const btn = document.getElementById("predictBtn");
    const scanner = document.getElementById("scannerBar");

    if (!imageElement) {
        btn.textContent = "Please select an image first!";
        return;
    }

    btn.textContent = "Scanning…";
    scanner.style.display = "block";

    await new Promise(r => setTimeout(r, 1200));

    const predictions = await model.predict(imageElement);
    predictions.sort((a, b) => b.probability - a.probability);

    const top = predictions[0];
    lastTopPrediction = top;

    scanner.style.display = "none";

    btn.textContent =
        `Detected: ${top.className} (${(top.probability * 100).toFixed(2)}%)`;

    renderBars(predictions);
    createResultCard(top);
}
</script>

</body>
</html>
